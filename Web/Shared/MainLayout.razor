@using Shareds.Modeles
@using Web.Services
@inherits LayoutComponentBase

@inject NavigationManager NavigationM
@inject UserService userService

<PageTitle>Web</PageTitle>

<div class="page">
    @if (userSession is not null)
    {
        <div class="sidebar">
            <NavMenu />
        </div>
    }

    <main>
        <div class="top-row px-4">          
            @if (userSession is not null)
            {
                <a href="" @onclick="(()=>Logout())">
                    @userSession.Name
                </a>
            }
            else
            {
                if (UserService.isLoginPage)
                {
                    <button class="btn btn-outline-primary" href="" @onclick="(()=>GoToLogin())">
                        Se connecter
                    </button>
                }
                else
                {
                    <button class="btn btn-outline-primary" href="" @onclick="(()=>GoToRegister())">
                        Créer un compte
                    </button>
                }
            }          
        </div>

        <article class="content px-4">
            @Body
        </article>

        <div class="top-row px-4">
            <p>Cop</p>
        </div>
    </main>
</div>

@code {
    public int text = 0;

    private UserSession userSession;

    protected override void OnParametersSet()
    {
        base.OnParametersSet();
    }

    protected override void OnInitialized()
    {
        //userSession = await userService.GetUserSession();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        base.OnAfterRender(firstRender);

        userSession = await userService.GetUserSession();
    }

    public void GoToLogin()
    {
        UserService.isLoginPage = false;
        NavigationM.NavigateTo("/login");
    }

    public void GoToRegister()
    {
        UserService.isLoginPage = true;
        NavigationM.NavigateTo("/register");
    }

    public void Logout()
    {
        userService.Logout();
        NavigationM.NavigateTo("/");
    }
}
